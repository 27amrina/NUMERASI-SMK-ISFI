<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Asesmen Numerasi Kelas XI SMK ISFI Banjarmasin</title>
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- jsPDF for PDF export -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    body { background: #f8f9fa; }
    .sidebar { max-height: 80vh; overflow-y: auto; }
    .qbtn { width: 44px; height: 44px; margin: 3px; }
    .qbtn.answered { border-color: #198754; }
    .qbtn.active { border-width: 2px; }
    .sticky-top-custom { position: sticky; top: 1rem; }
    .question-card { min-height: 380px; }
    .name-card { max-width: 760px; }
  </style>
</head>
<body>
  <div class="container py-4">

    <!-- START SCREEN -->
    <div id="startScreen" class="d-flex justify-content-center">
      <div class="card shadow name-card w-100">
        <div class="card-body p-4">
          <h1 class="h4 mb-2 text-center text-uppercase">Asesmen Numerasi Kelas XI<br>SMK ISFI Banjarmasin</h1>
          <p class="text-muted mb-4 text-center">Isi identitas, lalu tekan <b>Mulai</b> untuk memulai pengerjaan <b>25 soal</b> pilihan ganda. Navigasikan lewat tombol <i>Next/Back</i> atau daftar nomor di sebelah kiri.</p>
          <form id="identityForm" class="row g-3 justify-content-center">
            <div class="col-md-5">
              <label for="nama" class="form-label">Nama Siswa</label>
              <input type="text" class="form-control" id="nama" required>
            </div>
            <div class="col-md-5">
              <label for="kelas" class="form-label">Kelas</label>
              <input type="text" class="form-control" id="kelas" placeholder="XI Farmasi / XI Akuntansi, dll." required>
            </div>
            <div class="col-12 d-flex justify-content-center align-items-center gap-2 mt-2">
              <button type="submit" class="btn btn-primary px-4">Mulai</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- ASSESSMENT UI -->
    <div id="examUI" class="d-none">
      <div class="row g-4">
        <!-- Sidebar kiri: daftar nomor soal -->
        <div class="col-lg-4">
          <div class="card shadow-sm sticky-top-custom">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h2 class="h6 mb-0">Nomor Soal</h2>
                <span class="badge text-bg-light" id="answeredBadge">0/25 terjawab</span>
              </div>
              <div id="numberGrid" class="sidebar d-flex flex-wrap"></div>
              <hr>
              <div class="small text-muted">
                <span class="me-3"><span class="badge border me-1">&nbsp;</span> Belum</span>
                <span class="me-3"><span class="badge border border-success me-1">&nbsp;</span> Terjawab</span>
                <span class="me-3"><span class="badge bg-primary me-1">&nbsp;</span> Aktif</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Panel kanan: konten soal -->
        <div class="col-lg-8">
          <!-- Identitas ringkas + progress -->
          <div class="card shadow-sm mb-3">
            <div class="card-body d-flex flex-wrap gap-3 align-items-center">
              <div>
                <div class="small text-muted">Nama</div>
                <div class="fw-semibold" id="dispNama">-</div>
              </div>
              <div>
                <div class="small text-muted">Kelas</div>
                <div class="fw-semibold" id="dispKelas">-</div>
              </div>
              <div class="flex-grow-1">
                <div class="small text-muted mb-1">Progres</div>
                <div class="progress" role="progressbar" aria-label="progress" aria-valuemin="0" aria-valuemax="25">
                  <div id="progressBar" class="progress-bar" style="width: 0%">0%</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card shadow-sm question-card">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <h2 class="h5 mb-0" id="qTitle">Soal 1</h2>
                <span class="badge text-bg-secondary" id="skillTag">-</span>
              </div>
              <div id="qText" class="mb-3"></div>
              <div id="options" class="list-group"></div>
            </div>
          </div>

          <div class="d-flex justify-content-between align-items-center mt-3">
            <button id="btnBack" class="btn btn-outline-secondary" disabled>Back</button>
            <div class="d-flex gap-2">
              <button id="btnClear" class="btn btn-warning">Kosongkan Jawaban</button>
              <button id="btnNext" class="btn btn-primary">Next</button>
              <button id="btnFinish" class="btn btn-success d-none">Selesai</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- SUMMARY -->
    <div id="summaryUI" class="d-none">
      <div class="card shadow">
        <div class="card-body">
          <h2 class="h4 mb-3">Rekap Hasil</h2>
          <div class="row g-3 mb-3">
            <div class="col-md-4">
              <div class="border rounded p-3 h-100">
                <div class="small text-muted">Nama</div>
                <div class="fw-semibold" id="sumNama">-</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="border rounded p-3 h-100">
                <div class="small text-muted">Kelas</div>
                <div class="fw-semibold" id="sumKelas">-</div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="border rounded p-3 h-100">
                <div class="small text-muted">Skor</div>
                <div class="fw-semibold" id="sumSkor">-</div>
              </div>
            </div>
          </div>
          <div class="alert alert-info" id="levelInfo">Tingkatan Kemahiran: -</div>

          <div class="table-responsive">
            <table class="table table-sm table-striped">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Soal (ringkas)</th>
                  <th>Jawaban Anda</th>
                  <th>Kunci</th>
                  <th>Benar?</th>
                </tr>
              </thead>
              <tbody id="resultBody"></tbody>
            </table>
          </div>

          <div class="d-flex gap-2">
            <button id="btnDownloadPDF" class="btn btn-primary">Download Hasil (PDF)</button>
            <button id="btnRestart" class="btn btn-outline-secondary">Mulai Ulang</button>
          </div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // ====== Bank Soal (25 soal) ======
    // Struktur: {q: 'teks', opts: ['A','B','C','D'], ans: 0..3, tag:'Aljabar/Geometri/Statistika/Probabilitas/Keuangan/Trigonometri/Barisan/Limit/Fungsi/Lainnya'}
    const QUESTIONS = [
      { q: 'Nilai x yang memenuhi 3x - 7 = 2x + 8 adalah ...', opts: ['15', '−15', '−1', '1'], ans: 0, tag:'Aljabar' },
      { q: 'Jika f(x)=2x^2−3x+1, maka f(−2)= ...', opts: ['15', '11', '7', '3'], ans: 1, tag:'Fungsi' },
      { q: 'Suku ke-10 barisan aritmetika a1=5, d=3 adalah ...', opts: ['32', '35', '38', '41'], ans: 3, tag:'Barisan' },
      { q: 'Hasil dari (2x^3) : (4x) adalah ...', opts: ['x^2/2', 'x^2', 'x', '2x^2'], ans: 0, tag:'Aljabar' },
      { q: 'Persamaan garis melalui (1,2) dan (3,6) adalah ...', opts: ['y=2x', 'y=2x+1', 'y=3x−1', 'y=x+1'], ans: 0, tag:'Geometri Analitik' },
      { q: 'Jika sin θ = 3/5 dengan θ tumpul, maka cos θ = ...', opts: ['4/5', '−4/5', '3/5', '−3/5'], ans: 1, tag:'Trigonometri' },
      { q: 'Limit lim_{x→2} (x^2−4)/(x−2) = ...', opts: ['2', '3', '4', '5'], ans: 2, tag:'Limit' },
      { q: 'Median dari data: 4, 7, 8, 9, 12, 13, 15 adalah ...', opts: ['8', '9', '10', '11'], ans: 1, tag:'Statistika' },
      { q: 'Peluang muncul angka genap pada dadu sempurna adalah ...', opts: ['1/6', '1/3', '1/2', '2/3'], ans: 2, tag:'Probabilitas' },
      { q: 'Jika (x−2)(x+5)=0, maka jumlah akar-akarnya adalah ...', opts: ['3', '−3', '2', '5'], ans: 0, tag:'Aljabar' },
      { q: 'V=(1/3)πr^2t. Jika r dilipatgandakan dan t tetap, volume menjadi ...', opts: ['2V', '3V', '4V', '8V'], ans: 2, tag:'Geometri' },
      { q: 'Sebuah barang didiskon 20% dari harga 250.000. Harga setelah diskon adalah ...', opts: ['150.000', '175.000', '200.000', '225.000'], ans: 1, tag:'Keuangan' },
      { q: 'Jika log_2 x = 5, maka x = ...', opts: ['7', '10', '25', '32'], ans: 3, tag:'Logaritma' },
      { q: 'Gradien garis 3y − 6x + 9 = 0 adalah ...', opts: ['−2', '2', '1/2', '−1/2'], ans: 1, tag:'Geometri Analitik' },
      { q: 'Jika a^2−b^2 = (a−b)(a+b), maka 21^2−19^2 = ...', opts: ['80', '40', '20', '400'], ans: 0, tag:'Aljabar' },
      { q: 'Suku ke-n barisan geometri a1=2, r=3 adalah ...', opts: ['2·3^{n}', '2·3^{n−1}', '3·2^{n−1}', '2^{n}·3'], ans: 1, tag:'Barisan' },
      { q: 'Jika tan α = 3/4, maka sin α = ... (α lancip)', opts: ['3/5', '4/5', '3/4', '4/3'], ans: 0, tag:'Trigonometri' },
      { q: 'Himpunan penyelesaian |x−5|<3 adalah ...', opts: ['x<2 atau x>8', '2<x<8', 'x≤2', 'x≥8'], ans: 1, tag:'Aljabar' },
      { q: 'Mean dari 6, 7, 9, 10, 13 adalah ...', opts: ['8', '9', '9.5', '10'], ans: 1, tag:'Statistika' },
      { q: 'Matrix A= [1 2; 3 4]. Nilai det(A) adalah ...', opts: ['−2', '−1', '1', '2'], ans: 0, tag:'Matriks' },
      { q: 'Persentase kenaikan dari 80 ke 100 adalah ...', opts: ['20%', '25%', '30%', '40%'], ans: 1, tag:'Keuangan' },
      { q: 'Jika f(x)=( x+1, x<0; 2x−1, x≥0 ), maka f(3)= ...', opts: ['4', '5', '6', '−1'], ans: 1, tag:'Fungsi' },
      { q: 'Persamaan kuadrat dengan akar 2 dan 5 adalah ...', opts: ['x^2−7x+10=0', 'x^2−7x−10=0', 'x^2+7x+10=0', 'x^2−3x+10=0'], ans: 0, tag:'Aljabar' },
      { q: 'Keliling lingkaran dengan r=7 adalah ... (π=22/7)', opts: ['22', '44', '66', '88'], ans: 2, tag:'Geometri' },
      { q: 'Turunan d/dx (x^2−4x+1) adalah ...', opts: ['x−4', '2x−4', '2x−1', 'x^2−4'], ans: 1, tag:'Kalkulus' }
    ];

    // ====== State ======
    let current = 0;
    let answers = new Array(QUESTIONS.length).fill(null); // 0..3 atau null
    let identitas = { nama: '', kelas: '' };

    // ====== Elemen ======
    const startScreen = document.getElementById('startScreen');
    const examUI = document.getElementById('examUI');
    const summaryUI = document.getElementById('summaryUI');

    const dispNama = document.getElementById('dispNama');
    const dispKelas = document.getElementById('dispKelas');
    const qTitle = document.getElementById('qTitle');
    const skillTag = document.getElementById('skillTag');
    const qText = document.getElementById('qText');
    const optionsEl = document.getElementById('options');
    const numberGrid = document.getElementById('numberGrid');
    const answeredBadge = document.getElementById('answeredBadge');
    const progressBar = document.getElementById('progressBar');

    const btnBack = document.getElementById('btnBack');
    const btnNext = document.getElementById('btnNext');
    const btnFinish = document.getElementById('btnFinish');
    const btnClear = document.getElementById('btnClear');

    const sumNama = document.getElementById('sumNama');
    const sumKelas = document.getElementById('sumKelas');
    const sumSkor = document.getElementById('sumSkor');
    const levelInfo = document.getElementById('levelInfo');
    const resultBody = document.getElementById('resultBody');
    const btnDownloadPDF = document.getElementById('btnDownloadPDF');
    const btnRestart = document.getElementById('btnRestart');

    // ====== Utility ======
    function updateProgress(){
      const done = answers.filter(a => a !== null).length;
      answeredBadge.textContent = `${done}/${QUESTIONS.length} terjawab`;
      const pct = Math.round((done/QUESTIONS.length)*100);
      progressBar.style.width = pct + '%';
      progressBar.textContent = pct + '%';
      btnFinish.classList.toggle('d-none', done < QUESTIONS.length);
    }

    function renderNumberGrid(){
      numberGrid.innerHTML = '';
      for(let i=0;i<QUESTIONS.length;i++){
        const btn = document.createElement('button');
        btn.type='button';
        btn.className = 'btn btn-outline-secondary qbtn';
        btn.textContent = i+1;
        btn.setAttribute('aria-label', 'Soal ' + (i+1));
        btn.addEventListener('click', ()=>{ current=i; renderQuestion(); });
        numberGrid.appendChild(btn);
      }
      refreshNumberState();
    }

    function refreshNumberState(){
      [...numberGrid.children].forEach((btn, idx)=>{
        btn.classList.toggle('answered', answers[idx] !== null);
        btn.classList.toggle('active', idx === current);
        btn.classList.toggle('btn-outline-success', answers[idx] !== null);
        btn.classList.toggle('btn-outline-secondary', answers[idx] === null);
      });
    }

    function renderQuestion(){
      const item = QUESTIONS[current];
      qTitle.textContent = `Soal ${current+1}`;
      skillTag.textContent = item.tag;
      qText.textContent = item.q;

      optionsEl.innerHTML = '';
      item.opts.forEach((opt, idx)=>{
        const id = `q${current}_opt${idx}`;
        const label = document.createElement('label');
        label.className = 'list-group-item list-group-item-action d-flex align-items-center gap-2';

        const input = document.createElement('input');
        input.type='radio';
        input.name = `q${current}`;
        input.id = id;
        input.className = 'form-check-input me-2';
        input.checked = answers[current] === idx;
        input.addEventListener('change', ()=>{
          answers[current] = idx;
          refreshNumberState();
          updateProgress();
        });

        const span = document.createElement('span');
        span.textContent = String.fromCharCode(65+idx) + '. ' + opt;

        label.appendChild(input);
        label.appendChild(span);
        optionsEl.appendChild(label);
      });

      btnBack.disabled = current===0;
      btnNext.disabled = current===QUESTIONS.length-1;

      refreshNumberState();
    }

    function computeScore(){
      let correct = 0;
      const rows = [];
      QUESTIONS.forEach((it, idx)=>{
        const user = answers[idx];
        const isRight = user === it.ans;
        if(isRight) correct++;
        rows.push({
          no: idx+1,
          ringkas: it.q.length>60 ? it.q.slice(0,60)+'…' : it.q,
          jawaban: user===null? '-' : `${String.fromCharCode(65+user)}. ${it.opts[user]}`,
          kunci: `${String.fromCharCode(65+it.ans)}. ${it.opts[it.ans]}`,
          benar: isRight? '✓' : '✗'
        });
      });
      const percent = Math.round(100*correct/QUESTIONS.length);
      return { correct, percent, rows };
    }

    function levelFromPercent(p){
      if(p>=85) return {label:'Unggul', desc:'Kemahiran sangat tinggi, penguasaan materi sangat baik.'};
      if(p>=70) return {label:'Mahir', desc:'Kemahiran baik, konsep utama dikuasai dengan stabil.'};
      if(p>=50) return {label:'Berkembang', desc:'Dasar-dasar cukup, perlu penguatan dan latihan lanjut.'};
      return {label:'Dasar', desc:'Perlu pendampingan intensif pada konsep-konsep kunci.'};
    }

    // ====== PDF Builder ======
    async function downloadPDF(result){
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ unit: 'pt', format: 'a4' });
      const marginX = 48;
      const marginY = 56;
      let y = marginY;

      const percent = result.percent;
      const lvl = levelFromPercent(percent);

      doc.setFont('helvetica', 'bold');
      doc.setFontSize(16);
      doc.text('HASIL ASESMEN NUMERASI KELAS XI — SMK ISFI BANJARMASIN', marginX, y);
      y += 22;
      doc.setFont('helvetica', 'normal');
      doc.setFontSize(11);
      doc.text(`Nama  : ${identitas.nama}`, marginX, y); y += 16;
      doc.text(`Kelas : ${identitas.kelas}`, marginX, y); y += 16;
      doc.text(`Skor  : ${percent}% (${result.correct}/${QUESTIONS.length})`, marginX, y); y += 16;
      doc.text(`Level : ${lvl.label} — ${lvl.desc}`, marginX, y); y += 24;

      doc.setFont('helvetica', 'bold');
      doc.text('Rincian Per Soal', marginX, y); y += 18;
      doc.setFont('helvetica', 'normal');

      const pageH = doc.internal.pageSize.getHeight();
      const lineHeight = 14;
      result.rows.forEach((r)=>{
        const lines = [
          `${r.no}. ${r.ringkas}`,
          `   Jawaban Anda : ${r.jawaban}`,
          `   Kunci        : ${r.kunci}`,
          `   Benar?       : ${r.benar}`
        ];
        lines.forEach(text=>{
          const wrapped = doc.splitTextToSize(text, 520);
          wrapped.forEach(wline=>{
            if (y + lineHeight > pageH - marginY){
              doc.addPage();
              y = marginY;
            }
            doc.text(wline, marginX, y);
            y += lineHeight;
          });
        });
        y += 6; // space after each question
      });

      const fname = `Hasil_Asesmen_${identitas.nama.replace(/\s+/g,'_')}.pdf`;
      doc.save(fname);
    }

    // ====== Event wiring ======
    document.getElementById('identityForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const nama = document.getElementById('nama').value.trim();
      const kelas = document.getElementById('kelas').value.trim();
      if(!nama || !kelas){
        alert('Harap isi Nama dan Kelas.');
        return;
      }
      identitas = { nama, kelas };
      dispNama.textContent = nama;
      dispKelas.textContent = kelas;

      startScreen.classList.add('d-none');
      examUI.classList.remove('d-none');

      renderNumberGrid();
      renderQuestion();
      updateProgress();
    });

    btnBack.addEventListener('click', ()=>{
      if(current>0){ current--; renderQuestion(); }
    });
    btnNext.addEventListener('click', ()=>{
      if(current<QUESTIONS.length-1){ current++; renderQuestion(); }
    });
    btnClear.addEventListener('click', ()=>{
      answers[current] = null;
      renderQuestion();
      updateProgress();
    });

    btnFinish.addEventListener('click', ()=>{
      const result = computeScore();
      const lvl = levelFromPercent(result.percent);
      // Tampilkan ringkasan
      sumNama.textContent = identitas.nama;
      sumKelas.textContent = identitas.kelas;
      sumSkor.textContent = `${result.percent}% (${result.correct}/${QUESTIONS.length})`;
      levelInfo.textContent = `Tingkatan Kemahiran: ${lvl.label} — ${lvl.desc}`;

      resultBody.innerHTML = '';
      result.rows.forEach(r=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r.no}</td><td>${r.ringkas}</td><td>${r.jawaban}</td><td>${r.kunci}</td><td>${r.benar}</td>`;
        resultBody.appendChild(tr);
      });

      examUI.classList.add('d-none');
      summaryUI.classList.remove('d-none');
    });

    btnDownloadPDF.addEventListener('click', ()=>{
      const result = computeScore();
      downloadPDF(result);
    });

    btnRestart.addEventListener('click', ()=>{
      // reset
      current = 0;
      answers = new Array(QUESTIONS.length).fill(null);
      identitas = { nama:'', kelas:'' };
      document.getElementById('identityForm').reset();

      summaryUI.classList.add('d-none');
      startScreen.classList.remove('d-none');
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
